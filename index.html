<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TikTok Profile Downloader</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f5f5f5;
}
.container {
    max-width: 400px;
    margin: 40px auto;
    background: white;
    padding: 20px;
    border-radius: 8px;
}
input, button {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
}
#progressBox {
    height: 250px;
    border: 1px solid #ccc;
    margin-top: 15px;
    overflow-y: auto;
}
.bar {
    height: 0%;
    width: 100%;
    background: green;
}
.log {
    font-size: 12px;
    padding: 4px;
}
</style>
</head>

<body>
<div class="container">
    <h3>TikTok Profile Downloader</h3>

    <input id="profile" placeholder="TikTok profile URL">

    <button onclick="start()">Fetch all videos from profile</button>

    <div id="progressBox">
        <div id="bar" class="bar"></div>
    </div>

    <div id="status"></div>
</div>

<script>
const BACKEND = "https://tiktok-downloader-backend-production-ce2b.up.railway.app";

async function start() {
    document.getElementById("status").innerText = "Fetching video list...";
    document.getElementById("bar").style.height = "0%";

    const response = await fetch(`${BACKEND}/profile/stream`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            profile_url: document.getElementById("profile").value
        })
    });

    if (!response.ok) {
        document.getElementById("status").innerText = "Failed to fetch";
        return;
    }

    const reader = response.body.getReader();
    const decoder = new TextDecoder();

    let received = "";

    while (true) {
        const { value, done } = await reader.read();
        if (done) break;

        received += decoder.decode(value, { stream: true });
        const lines = received.split("\n");
        received = lines.pop();

        for (const line of lines) {
            if (!line.trim()) continue;

            const data = JSON.parse(line);
            const percent = Math.round((data.current / data.total) * 100);

            document.getElementById("bar").style.height = percent + "%";
            document.getElementById("status").innerText =
                `Fetched ${data.current} / ${data.total}`;
        }
    }

    document.getElementById("status").innerText = "All videos fetched";
}
</script>
</body>
</html>
