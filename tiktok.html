<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>TikTok Video Downloader</title>
<meta name="description" content="Preview and download publicly accessible TikTok videos from single links or public profiles.">

<style>
*{margin:0;padding:0;box-sizing:border-box}

:root{
--bg:#0b0f1a;
--card:rgba(255,255,255,0.04);
--border:#1e2440;
--text:#eaeaf0;
--muted:#9aa4c7;
--accent:#ff2d55;
}

body{
font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
background:var(--bg);
color:var(--text);
line-height:1.6;
}

.main-container{
max-width:1000px;
margin:auto;
padding:40px 16px 60px;
}

.hero{text-align:center;margin-bottom:30px}
.hero h1{font-size:2rem;margin-bottom:10px}
.hero p{color:var(--muted)}

.card{
background:var(--card);
border:1px solid var(--border);
border-radius:16px;
padding:22px;
margin-bottom:24px;
}

input{
width:100%;
padding:14px;
border-radius:10px;
border:1px solid var(--border);
background:transparent;
color:inherit;
margin-bottom:14px;
}

button{
background:var(--accent);
border:none;
color:#fff;
padding:12px 16px;
border-radius:10px;
cursor:pointer;
font-size:.95rem;
}

.status{margin-top:8px;color:var(--muted)}

#progressWrap{display:none;margin-top:14px}
#progressOuter{height:6px;background:#222;border-radius:6px;overflow:hidden}
#progressBar{height:100%;width:0%;background:var(--accent)}

#bulkActions{display:none;margin:16px 0;gap:10px;flex-wrap:wrap}

.single-preview{
display:flex;
gap:16px;
margin-top:20px;
flex-wrap:wrap;
}
.single-preview img{
width:160px;
aspect-ratio:9/16;
object-fit:cover;
border-radius:12px;
background:#000;
}

/* PROFILE GRID */
.profile-grid{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(170px,1fr));
gap:16px;
margin-top:24px;
}
.profile-item{
background:var(--card);
border:1px solid var(--border);
border-radius:14px;
padding:10px;
display:flex;
flex-direction:column;
gap:6px;
}
.profile-item img{
width:100%;
aspect-ratio:9/16;
border-radius:10px;
background:#111;
object-fit:cover;
}
.profile-item .title{
font-size:.85rem;
color:var(--muted);
text-align:center;
}
</style>
</head>

<body>

<main class="main-container">

<section class="hero">
<h1>TikTok Video Downloader</h1>
<p>Preview single videos or bulk download public profiles.</p>
</section>

<section class="card">
<form id="tiktokForm">
<input id="videoUrl" type="text" placeholder="Paste TikTok video or profile link" required>
<button type="submit">Fetch</button>
</form>

<div id="status" class="status"></div>

<div id="progressWrap">
<div id="progressOuter"><div id="progressBar"></div></div>
</div>

<div id="bulkActions">
<button onclick="selectAll()">Select All</button>
<button onclick="deselectAll()">Deselect All</button>
<button onclick="downloadSelected()">Download Selected</button>
</div>

<div id="singlePreview"></div>
<div id="profileGrid" class="profile-grid"></div>
</section>

</main>

<script>
const API="https://tiktok-downloader-backend-production-ce2b.up.railway.app";

const form=document.getElementById("tiktokForm");
const input=document.getElementById("videoUrl");
const statusBox=document.getElementById("status");
const singlePreview=document.getElementById("singlePreview");
const profileGrid=document.getElementById("profileGrid");
const bulkActions=document.getElementById("bulkActions");

let videos=[];
let selected=new Set();

function startProgress(){
const wrap=document.getElementById("progressWrap");
const bar=document.getElementById("progressBar");
wrap.style.display="block";
let p=0;
return setInterval(()=>{
p+=8;
if(p>90)p=90;
bar.style.width=p+"%";
},300);
}

form.addEventListener("submit",async e=>{
e.preventDefault();
statusBox.textContent="Loading...";
singlePreview.innerHTML="";
profileGrid.innerHTML="";
bulkActions.style.display="none";
selected.clear();

const url=input.value.trim();
const isProfile=url.includes("/@") && !url.includes("/video/");
const timer=startProgress();

try{
if(isProfile){
const res=await fetch(`${API}/profile?profile_url=${encodeURIComponent(url)}`);
const data=await res.json();
clearInterval(timer);

if(!res.ok){statusBox.textContent="Profile blocked";return;}

videos=data.videos;
statusBox.textContent=`Found ${data.total} videos`;
bulkActions.style.display="flex";
renderGrid();

}else{
const res=await fetch(`${API}/preview?url=${encodeURIComponent(url)}`);
const data=await res.json();
clearInterval(timer);

singlePreview.innerHTML=`
<div class="single-preview">
<img src="${data.thumbnail}">
<div>
<strong>${data.title}</strong><br>
Uploader: ${data.uploader}<br><br>
<button onclick="download('${url}',1)">Download</button>
</div>
</div>`;
statusBox.textContent="Preview loaded";
}
}catch{
statusBox.textContent="Error loading.";
}
});

function renderGrid(){
profileGrid.innerHTML="";
videos.forEach(v=>{
const div=document.createElement("div");
div.className="profile-item";
div.innerHTML=`
<input type="checkbox" ${selected.has(v.index)?"checked":""}
 onchange="toggle(${v.index})">
<img src="https://placehold.co/300x500?text=Video">
<div class="title">Video #${v.index}</div>
<button onclick="download('${v.url}',${v.index})">Download</button>`;
profileGrid.appendChild(div);
});
}

function toggle(i){
selected.has(i)?selected.delete(i):selected.add(i);
}

function selectAll(){videos.forEach(v=>selected.add(v.index));renderGrid();}
function deselectAll(){selected.clear();renderGrid();}

async function downloadSelected(){
for(const v of videos){
if(selected.has(v.index)){
download(v.url,v.index);
await new Promise(r=>setTimeout(r,2000));
}
}
}

function download(url,index){
window.location.href=
`${API}/download?url=${encodeURIComponent(url)}&index=${index}&profile=profile`;
}
</script>

</body>
</html>
